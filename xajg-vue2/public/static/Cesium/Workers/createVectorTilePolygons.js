define(["./AttributeCompression-cf8328fe","./Matrix4-3b2c0630","./Ellipsoid-119327cb","./Color-5a9f5f10","./defaultValue-81eec7ed","./IndexDatatype-266e701d","./Math-c2b1b304","./OrientedBoundingBox-8f892e7f","./Matrix2-115e2170","./createTaskProcessorWorker","./ComponentDatatype-c4f4738c","./RuntimeError-8952249c","./WebGLConstants-508b9636","./Transforms-51e2663f","./_commonjsHelpers-3aae1032-26891ab7","./combine-3c023bda","./EllipsoidTangentPlane-6354c9aa","./AxisAlignedBoundingBox-ace5a411","./IntersectionTests-4511d2eb","./Plane-f0451b7c"],(function(e,t,n,a,r,o,i,s,c,f,d,l,u,h,p,g,b,m,y,C){"use strict";const I=new t.Cartesian3,x=new n.Ellipsoid,w=new c.Rectangle,A={min:void 0,max:void 0,indexBytesPerElement:void 0};function E(e,t,n){const r=t.length,o=2+r*s.OrientedBoundingBox.packedLength+1+function(e){const t=e.length;let n=0;for(let r=0;r<t;++r)n+=a.Color.packedLength+3+e[r].batchIds.length;return n}(n),i=new Float64Array(o);let c=0;i[c++]=e,i[c++]=r;for(let e=0;e<r;++e)s.OrientedBoundingBox.pack(t[e],i,c),c+=s.OrientedBoundingBox.packedLength;const f=n.length;i[c++]=f;for(let e=0;e<f;++e){const t=n[e];a.Color.pack(t.color,i,c),c+=a.Color.packedLength,i[c++]=t.offset,i[c++]=t.count;const r=t.batchIds,o=r.length;i[c++]=o;for(let e=0;e<o;++e)i[c++]=r[e]}return i}const N=new t.Cartesian3,T=new t.Cartesian3,B=new t.Cartesian3,k=new t.Cartesian3,L=new t.Cartesian3,O=new n.Cartographic,U=new c.Rectangle;return f((function(f,d){let l;!function(e){const a=new Float64Array(e);let r=0;A.indexBytesPerElement=a[r++],A.min=a[r++],A.max=a[r++],t.Cartesian3.unpack(a,r,I),r+=t.Cartesian3.packedLength,n.Ellipsoid.unpack(a,r,x),r+=n.Ellipsoid.packedLength,c.Rectangle.unpack(a,r,w)}(f.packedBuffer),l=2===A.indexBytesPerElement?new Uint16Array(f.indices):new Uint32Array(f.indices);const u=new Uint16Array(f.positions),h=new Uint32Array(f.counts),p=new Uint32Array(f.indexCounts),g=new Uint32Array(f.batchIds),b=new Uint32Array(f.batchTableColors),m=new Array(h.length),y=I,C=x;let P=w;const F=A.min,M=A.max;let S,D,R,_=f.minimumHeights,G=f.maximumHeights;r.defined(_)&&r.defined(G)&&(_=new Float32Array(_),G=new Float32Array(G));const V=u.length/2,Y=u.subarray(0,V),H=u.subarray(V,2*V);e.AttributeCompression.zigZagDeltaDecode(Y,H);const v=new Float64Array(3*V);for(S=0;S<V;++S){const e=Y[S],a=H[S],r=i.CesiumMath.lerp(P.west,P.east,e/32767),o=i.CesiumMath.lerp(P.south,P.north,a/32767),s=n.Cartographic.fromRadians(r,o,0,O),c=C.cartographicToCartesian(s,N);t.Cartesian3.pack(c,v,3*S)}const W=h.length,j=new Array(W),z=new Array(W);let Z=0,q=0;for(S=0;S<W;++S)j[S]=Z,z[S]=q,Z+=h[S],q+=p[S];const J=new Float32Array(3*V*2),K=new Uint16Array(2*V),Q=new Uint32Array(z.length),X=new Uint32Array(p.length);let $=[];const ee={};for(S=0;S<W;++S)R=b[S],r.defined(ee[R])?(ee[R].positionLength+=h[S],ee[R].indexLength+=p[S],ee[R].batchIds.push(S)):ee[R]={positionLength:h[S],indexLength:p[S],offset:0,indexOffset:0,batchIds:[S]};let te,ne=0,ae=0;for(R in ee)if(ee.hasOwnProperty(R)){te=ee[R],te.offset=ne,te.indexOffset=ae;const e=2*te.positionLength,t=2*te.indexLength+6*te.positionLength;ne+=e,ae+=t,te.indexLength=t}const re=[];for(R in ee)ee.hasOwnProperty(R)&&(te=ee[R],re.push({color:a.Color.fromRgba(parseInt(R)),offset:te.indexOffset,count:te.indexLength,batchIds:te.batchIds}));for(S=0;S<W;++S){R=b[S],te=ee[R];const e=te.offset;let n=3*e,a=e;const o=j[S],i=h[S],c=g[S];let f=F,d=M;r.defined(_)&&r.defined(G)&&(f=_[S],d=G[S]);let u=Number.POSITIVE_INFINITY,I=Number.NEGATIVE_INFINITY,x=Number.POSITIVE_INFINITY,w=Number.NEGATIVE_INFINITY;for(D=0;D<i;++D){const e=t.Cartesian3.unpack(v,3*o+3*D,N);C.scaleToGeodeticSurface(e,e);const r=C.cartesianToCartographic(e,O),i=r.latitude,s=r.longitude;u=Math.min(i,u),I=Math.max(i,I),x=Math.min(s,x),w=Math.max(s,w);const l=C.geodeticSurfaceNormal(e,T);let h=t.Cartesian3.multiplyByScalar(l,f,B);const p=t.Cartesian3.add(e,h,k);h=t.Cartesian3.multiplyByScalar(l,d,h);const g=t.Cartesian3.add(e,h,L);t.Cartesian3.subtract(g,y,g),t.Cartesian3.subtract(p,y,p),t.Cartesian3.pack(g,J,n),t.Cartesian3.pack(p,J,n+3),K[a]=c,K[a+1]=c,n+=6,a+=2}P=U,P.west=x,P.east=w,P.south=u,P.north=I,m[S]=s.OrientedBoundingBox.fromRectangle(P,F,M,C);let A=te.indexOffset;const E=z[S],V=p[S];for(Q[S]=A,D=0;D<V;D+=3){const t=l[E+D]-o,n=l[E+D+1]-o,a=l[E+D+2]-o;$[A++]=2*t+e,$[A++]=2*n+e,$[A++]=2*a+e,$[A++]=2*a+1+e,$[A++]=2*n+1+e,$[A++]=2*t+1+e}for(D=0;D<i;++D){const t=D,n=(D+1)%i;$[A++]=2*t+1+e,$[A++]=2*n+e,$[A++]=2*t+e,$[A++]=2*t+1+e,$[A++]=2*n+1+e,$[A++]=2*n+e}te.offset+=2*i,te.indexOffset=A,X[S]=A-Q[S]}$=o.IndexDatatype.createTypedArray(J.length/3,$);const oe=re.length;for(let e=0;e<oe;++e){const t=re[e].batchIds;let n=0;const a=t.length;for(let e=0;e<a;++e)n+=X[t[e]];re[e].count=n}const ie=E(2===$.BYTES_PER_ELEMENT?o.IndexDatatype.UNSIGNED_SHORT:o.IndexDatatype.UNSIGNED_INT,m,re);return d.push(J.buffer,$.buffer,Q.buffer,X.buffer,K.buffer,ie.buffer),{positions:J.buffer,indices:$.buffer,indexOffsets:Q.buffer,indexCounts:X.buffer,batchIds:K.buffer,packedBuffer:ie.buffer}}))}));
