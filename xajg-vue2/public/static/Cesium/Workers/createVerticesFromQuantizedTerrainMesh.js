define(["./AxisAlignedBoundingBox-ace5a411","./Matrix2-115e2170","./Matrix4-3b2c0630","./Ellipsoid-119327cb","./defaultValue-81eec7ed","./TerrainEncoding-0ae22bd9","./IndexDatatype-266e701d","./Math-c2b1b304","./RuntimeError-8952249c","./Transforms-51e2663f","./WebMercatorProjection-dd895f93","./createTaskProcessorWorker","./AttributeCompression-cf8328fe","./ComponentDatatype-c4f4738c","./WebGLConstants-508b9636","./_commonjsHelpers-3aae1032-26891ab7","./combine-3c023bda"],(function(e,t,r,n,o,i,a,s,c,d,h,u,l,I,g,m,T){"use strict";function E(){c.DeveloperError.throwInstantiationError()}Object.defineProperties(E.prototype,{errorEvent:{get:c.DeveloperError.throwInstantiationError},credit:{get:c.DeveloperError.throwInstantiationError},tilingScheme:{get:c.DeveloperError.throwInstantiationError},ready:{get:c.DeveloperError.throwInstantiationError},readyPromise:{get:c.DeveloperError.throwInstantiationError},hasWaterMask:{get:c.DeveloperError.throwInstantiationError},hasVertexNormals:{get:c.DeveloperError.throwInstantiationError},availability:{get:c.DeveloperError.throwInstantiationError}});const f=[];E.getRegularGridIndices=function(e,t){let r=f[e];o.defined(r)||(f[e]=r=[]);let n=r[t];return o.defined(n)||(n=e*t<s.CesiumMath.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),w(e,t,n,0)),n};const p=[];E.getRegularGridIndicesAndEdgeIndices=function(e,t){let r=p[e];o.defined(r)||(p[e]=r=[]);let n=r[t];if(!o.defined(n)){const o=E.getRegularGridIndices(e,t),i=N(e,t),a=i.westIndicesSouthToNorth,s=i.southIndicesEastToWest,c=i.eastIndicesNorthToSouth,d=i.northIndicesWestToEast;n=r[t]={indices:o,westIndicesSouthToNorth:a,southIndicesEastToWest:s,eastIndicesNorthToSouth:c,northIndicesWestToEast:d}}return n};const y=[];function N(e,t){const r=new Array(t),n=new Array(e),o=new Array(t),i=new Array(e);let a;for(a=0;a<e;++a)i[a]=a,n[a]=e*t-1-a;for(a=0;a<t;++a)o[a]=(a+1)*e-1,r[a]=(t-a-1)*e;return{westIndicesSouthToNorth:r,southIndicesEastToWest:n,eastIndicesNorthToSouth:o,northIndicesWestToEast:i}}function w(e,t,r,n){let o=0;for(let i=0;i<t-1;++i){for(let t=0;t<e-1;++t){const t=o,i=t+e,a=i+1,s=t+1;r[n++]=t,r[n++]=i,r[n++]=s,r[n++]=s,r[n++]=i,r[n++]=a,++o}++o}}function M(e,t,r,n){let o=e[0];const i=e.length;for(let a=1;a<i;++a){const i=e[a];r[n++]=o,r[n++]=i,r[n++]=t,r[n++]=t,r[n++]=i,r[n++]=t+1,o=i,++t}return n}E.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){let r=y[e];o.defined(r)||(y[e]=r=[]);let n=r[t];if(!o.defined(n)){const o=e*t,i=(e-1)*(t-1)*6,s=2*e+2*t,c=o+s,d=i+6*Math.max(0,s-4),h=N(e,t),u=h.westIndicesSouthToNorth,l=h.southIndicesEastToWest,I=h.eastIndicesNorthToSouth,g=h.northIndicesWestToEast,m=a.IndexDatatype.createTypedArray(c,d);w(e,t,m,0),E.addSkirtIndices(u,l,I,g,o,m,i),n=r[t]={indices:m,westIndicesSouthToNorth:u,southIndicesEastToWest:l,eastIndicesNorthToSouth:I,northIndicesWestToEast:g,indexCountWithoutSkirts:i}}return n},E.addSkirtIndices=function(e,t,r,n,o,i,a){let s=o;a=M(e,s,i,a),s+=e.length,a=M(t,s,i,a),s+=t.length,a=M(r,s,i,a),s+=r.length,M(n,s,i,a)},E.heightmapTerrainQuality=.25,E.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*E.heightmapTerrainQuality/(t*r)},E.prototype.requestTileGeometry=c.DeveloperError.throwInstantiationError,E.prototype.getLevelMaximumGeometricError=c.DeveloperError.throwInstantiationError,E.prototype.getTileDataAvailable=c.DeveloperError.throwInstantiationError,E.prototype.loadTileDataAvailability=c.DeveloperError.throwInstantiationError;const b=32767,S=new r.Cartesian3,x=new r.Cartesian3,A=new r.Cartesian3,C=new n.Cartographic,W=new t.Cartesian2;function v(e,t,n,o,i,a,c,d,h){let u=Number.POSITIVE_INFINITY;const l=i.north,I=i.south;let g=i.east;const m=i.west;g<m&&(g+=s.CesiumMath.TWO_PI);const T=e.length;for(let i=0;i<T;++i){const T=e[i],E=n[T],f=o[T];C.longitude=s.CesiumMath.lerp(m,g,f.x),C.latitude=s.CesiumMath.lerp(I,l,f.y),C.height=E-t;const p=a.cartographicToCartesian(C,S);r.Matrix4.multiplyByPoint(c,p,p),r.Cartesian3.minimumByComponent(p,d,d),r.Cartesian3.maximumByComponent(p,h,h),u=Math.min(u,C.height)}return u}function P(e,t,r,n,i,a,c,d,u,l,I,g,m,T){const E=o.defined(c),f=u.north,p=u.south;let y=u.east;const N=u.west;y<N&&(y+=s.CesiumMath.TWO_PI);const w=r.length;for(let o=0;o<w;++o){const u=r[o],w=i[u],M=a[u];C.longitude=s.CesiumMath.lerp(N,y,M.x)+m,C.latitude=s.CesiumMath.lerp(p,f,M.y)+T,C.height=w-l;const b=d.cartographicToCartesian(C,S);if(E){const e=2*u;W.x=c[e],W.y=c[e+1]}let x,A;n.hasWebMercatorT&&(x=(h.WebMercatorProjection.geodeticLatitudeToMercatorAngle(C.latitude)-I)*g),n.hasGeodeticSurfaceNormals&&(A=d.geodeticSurfaceNormal(b)),t=n.encode(e,t,b,M,C.height,W,x,A)}}function D(e,t){let r;return"function"==typeof e.slice&&(r=e.slice(),"function"!=typeof r.sort&&(r=void 0)),o.defined(r)||(r=Array.prototype.slice.call(e)),r.sort(t),r}return u((function(c,u){const l=c.quantizedVertices,I=l.length/3,g=c.octEncodedNormals,m=c.westIndices.length+c.eastIndices.length+c.southIndices.length+c.northIndices.length,T=c.includeWebMercatorT,f=c.exaggeration,p=c.exaggerationRelativeHeight,y=1!==f,N=t.Rectangle.clone(c.rectangle),w=N.west,M=N.south,k=N.east,F=N.north,H=n.Ellipsoid.clone(c.ellipsoid),_=c.minimumHeight,G=c.maximumHeight,V=c.relativeToCenter,Y=d.Transforms.eastNorthUpToFixedFrame(V,H),O=r.Matrix4.inverseTransformation(Y,new r.Matrix4);let B,R;T&&(B=h.WebMercatorProjection.geodeticLatitudeToMercatorAngle(M),R=1/(h.WebMercatorProjection.geodeticLatitudeToMercatorAngle(F)-B));const L=l.subarray(0,I),j=l.subarray(I,2*I),U=l.subarray(2*I,3*I),z=o.defined(g),q=new Array(I),Q=new Array(I),K=new Array(I),X=T?new Array(I):[],Z=y?new Array(I):[],J=x;J.x=Number.POSITIVE_INFINITY,J.y=Number.POSITIVE_INFINITY,J.z=Number.POSITIVE_INFINITY;const $=A;$.x=Number.NEGATIVE_INFINITY,$.y=Number.NEGATIVE_INFINITY,$.z=Number.NEGATIVE_INFINITY;let ee=Number.POSITIVE_INFINITY,te=Number.NEGATIVE_INFINITY,re=Number.POSITIVE_INFINITY,ne=Number.NEGATIVE_INFINITY;for(let e=0;e<I;++e){const n=L[e],o=j[e],i=n/b,a=o/b,c=s.CesiumMath.lerp(_,G,U[e]/b);C.longitude=s.CesiumMath.lerp(w,k,i),C.latitude=s.CesiumMath.lerp(M,F,a),C.height=c,ee=Math.min(C.longitude,ee),te=Math.max(C.longitude,te),re=Math.min(C.latitude,re),ne=Math.max(C.latitude,ne);const d=H.cartographicToCartesian(C);q[e]=new t.Cartesian2(i,a),Q[e]=c,K[e]=d,T&&(X[e]=(h.WebMercatorProjection.geodeticLatitudeToMercatorAngle(C.latitude)-B)*R),y&&(Z[e]=H.geodeticSurfaceNormal(d)),r.Matrix4.multiplyByPoint(O,d,S),r.Cartesian3.minimumByComponent(S,J,J),r.Cartesian3.maximumByComponent(S,$,$)}const oe=D(c.westIndices,(function(e,t){return q[e].y-q[t].y})),ie=D(c.eastIndices,(function(e,t){return q[t].y-q[e].y})),ae=D(c.southIndices,(function(e,t){return q[t].x-q[e].x})),se=D(c.northIndices,(function(e,t){return q[e].x-q[t].x}));let ce;if(_<0){ce=new i.EllipsoidalOccluder(H).computeHorizonCullingPointPossiblyUnderEllipsoid(V,K,_)}let de=_;de=Math.min(de,v(c.westIndices,c.westSkirtHeight,Q,q,N,H,O,J,$)),de=Math.min(de,v(c.southIndices,c.southSkirtHeight,Q,q,N,H,O,J,$)),de=Math.min(de,v(c.eastIndices,c.eastSkirtHeight,Q,q,N,H,O,J,$)),de=Math.min(de,v(c.northIndices,c.northSkirtHeight,Q,q,N,H,O,J,$));const he=new e.AxisAlignedBoundingBox(J,$,V),ue=new i.TerrainEncoding(V,he,de,G,Y,z,T,y,f,p),le=ue.stride,Ie=new Float32Array(I*le+m*le);let ge=0;for(let e=0;e<I;++e){if(z){const t=2*e;W.x=g[t],W.y=g[t+1]}ge=ue.encode(Ie,ge,K[e],q[e],Q[e],W,X[e],Z[e])}const me=Math.max(0,2*(m-4)),Te=c.indices.length+3*me,Ee=a.IndexDatatype.createTypedArray(I+m,Te);Ee.set(c.indices,0);const fe=1e-4,pe=(te-ee)*fe,ye=(ne-re)*fe,Ne=-pe,we=pe,Me=ye,be=-ye;let Se=I*le;return P(Ie,Se,oe,ue,Q,q,g,H,N,c.westSkirtHeight,B,R,Ne,0),Se+=c.westIndices.length*le,P(Ie,Se,ae,ue,Q,q,g,H,N,c.southSkirtHeight,B,R,0,be),Se+=c.southIndices.length*le,P(Ie,Se,ie,ue,Q,q,g,H,N,c.eastSkirtHeight,B,R,we,0),Se+=c.eastIndices.length*le,P(Ie,Se,se,ue,Q,q,g,H,N,c.northSkirtHeight,B,R,0,Me),E.addSkirtIndices(oe,ae,ie,se,I,Ee,c.indices.length),u.push(Ie.buffer,Ee.buffer),{vertices:Ie.buffer,indices:Ee.buffer,westIndicesSouthToNorth:oe,southIndicesEastToWest:ae,eastIndicesNorthToSouth:ie,northIndicesWestToEast:se,vertexStride:le,center:V,minimumHeight:_,maximumHeight:G,occludeePointInScaledSpace:ce,encoding:ue,indexCountWithoutSkirts:c.indices.length}}))}));
